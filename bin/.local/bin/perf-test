#! /usr/bin/bash

# The following values will be the same as the one used to create the broker. Copy and paste the same values for the username and password below.
BROKER_USER=admin # This is the postman collection's default
BROKER_PASSWORD=a1q80DcY9WblsEn

# This value corresponds to the "consoleURL" (without https://) from the result of the Describe Broker request.
BROKER_DNS=b-72b762a5-fb1b-4679-8afb-74ce452a763d.jlaperle.mq-dev.us-west-2.amazonaws.com

CONNECTION_STRING=amqps://${BROKER_USER}:${BROKER_PASSWORD}@${BROKER_DNS}:5671 # Any special characters in the password must be url encoded

# The following values can be anything eg: 1-1-1-1 or 100-100-100-100. Play with them to see how the broker load changes.
QUEUES_COUNT=1
PRODUCERS_COUNT=1
CONSUMERS_COUNT=1
PRODUCER_RATE=1

docker run -it --rm --ulimit nofile=40960:40960 pivotalrabbitmq/perf-test:latest \
    --queue-pattern 'test-queue-%d' --queue-pattern-from 1 --queue-pattern-to $QUEUES_COUNT \
    --producers $PRODUCERS_COUNT --consumers $CONSUMERS_COUNT \
    --id "test${QUEUES_COUNT}q${PRODUCERS_COUNT}p${CONSUMERS_COUNT}c${PRODUCER_RATE}r" \
    --uri ${CONNECTION_STRING} \
    --flag persistent --rate $PRODUCER_RATE
